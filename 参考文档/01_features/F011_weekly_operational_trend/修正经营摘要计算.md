# 周趋势分析经营摘要修正

## 修正日期
2025-10-26

## 问题描述
周趋势分析组件的经营摘要存在两个计算错误：

1. **年度累计签单保费计算错误**：原代码将所有周的签单保费相加，但在当前周值模式下，每周的数据本身就是年度累计值（从年初到该周的累计）。正确做法应该是取最新周（如第42周）的当前周值。

2. **平均赔付率显示多余**：经营摘要中显示"平均赔付率"并不直观，应该直接说明有多少周处于预警区，更符合风险监控的需求。

## 修正内容

### 1. 年度累计签单保费计算
**修正前**：
```typescript
const totalPremium = data.reduce((sum, d) => sum + d.signedPremium, 0)
summary += `年度累计签单保费 ${formatNumber(totalPremium / 10000, 2)} 亿元，`
```

**修正后**：
```typescript
const latestPremium = latestPoint.signedPremium
summary += `年度累计签单保费 ${formatNumber(latestPremium / 10000, 2)} 亿元`
```

**说明**：
- 数据源特性：CSV中每周的数据已经是年度累计值（从1月1日到该周结束）
- 第42周的数据 = 1月1日到第42周的累计保费
- 不需要再将各周数据相加

### 2. 赔付率表述优化
**修正前**：
```typescript
const avgLossRatio = data.filter((d) => d.lossRatio !== null)
  .reduce((sum, d) => sum + (d.lossRatio || 0), 0) /
  data.filter((d) => d.lossRatio !== null).length

summary += `平均赔付率 ${formatPercent(avgLossRatio, 1)}`
```

**修正后**：
```typescript
// 直接在风险提示中说明周数
if (consecutiveRiskWeeks > 0) {
  summary += `，连续 ${consecutiveRiskWeeks} 周处于预警区`
} else if (totalRiskWeeks > 0) {
  summary += `，${totalRiskWeeks} 周处于预警区`
} else {
  summary += `，经营状况良好`
}
```

**说明**：
- 移除了平均赔付率的计算和显示
- 直接显示处于预警区的周数统计，更直观
- 区分连续预警和累计预警两种情况

### 3. UI调整
移除了右上角的"平均赔付率"标签，只保留"高风险周"标签。

## 影响文件

### 代码文件
- [src/components/features/weekly-operational-trend.tsx](../../../src/components/features/weekly-operational-trend.tsx)
  - `generateOperationalSummary` 函数修正
  - 移除右上角平均赔付率标签

### 文档文件
- [USAGE.md](./USAGE.md)
  - 更新经营摘要说明
  - 更新识别风险说明
  - 修正场景5的操作步骤
  - 修正Q6的解释

- [README.md](./README.md)
  - 更新经营摘要核心指标说明

- [TECHNICAL.md](./TECHNICAL.md)
  - 更新经营摘要生成代码示例

## 修正示例

### 修正前的经营摘要
```
截至2025年第42周，年度累计签单保费 125.43 亿元，平均赔付率 68.5%，连续 3 周处于预警区
```
问题：125.43 亿元是错误的累加值

### 修正后的经营摘要
```
截至2025年第42周，年度累计签单保费 85.23 亿元，连续 3 周处于预警区
```
或
```
截至2025年第42周，年度累计签单保费 85.23 亿元，5 周处于预警区
```
优点：
- 85.23 亿元是第42周的正确累计值
- 移除了平均赔付率，更简洁直观
- 直接说明预警周数，便于风险评估

## 验证方法

1. 启动开发服务器：`pnpm dev`
2. 在浏览器中打开周趋势分析图表
3. 检查经营摘要：
   - 年度累计签单保费应该等于图表最右侧（最新周）的签单保费值
   - 不应该显示"平均赔付率"
   - 应该显示"X 周处于预警区"或"连续 X 周处于预警区"

## 相关文档
- [数据架构说明](../../03_technical_design/data_architecture.md) - CSV数据累计值特性
- [周趋势分析功能文档](./README.md) - 完整功能说明
