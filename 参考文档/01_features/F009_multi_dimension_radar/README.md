# F009 多维健康度雷达图

**功能标识**: F009
**功能名称**: 多维健康度雷达图
**状态**: ✅ 已实现
**优先级**: P1
**创建日期**: 2025-10-26
**最后更新**: 2025-11-02

---

## 📋 功能概述

多维健康度雷达图是一个综合性的可视化组件，通过雷达图形式同时展示5个核心业务维度的健康评分，帮助用户快速识别业务整体健康状况和潜在风险点。

### 核心价值

- **一图概全局**：5个关键维度在一个雷达图中清晰呈现
- **智能评分**：基于预警规则自动转换为0-100标准化评分
- **对比分析**：支持当前周与上周的对比分析
- **交互探索**：悬停高亮、详细信息展示
- **专业呈现**：采用业界标准的雷达图配色和布局

---

## 🎯 业务场景

### 主要用户

- **高层管理者**：快速了解业务整体健康度，识别关键风险
- **业务分析师**：多维度综合评估，发现短板和优势
- **区域经理**：监控区域业务健康状况

### 典型使用流程

1. 用户切换到"多维图表"标签页
2. 雷达图自动加载当前筛选范围的数据
3. 用户查看综合评分和雷达图形态
4. 悬停在各个维度上查看详细数值
5. 对比当前周与上周的变化趋势
6. 下方卡片展示各维度的详细信息

---

## 📊 五大核心维度

### 1. 满期边际贡献率 (contribution_margin_ratio)

**业务含义**: 反映业务盈利能力的核心指标

**评分规则**:
| 原始值范围 | 评分范围 | 等级 | 色彩 |
|-----------|---------|------|------|
| > 12% | 95-100 | 优秀 | 深绿 #2E7D32 |
| 8-12% | 86-94 | 良好 | 浅绿 #4CAF50 |
| 6-8% | 70-85 | 中等 | 蓝色 #1976D2 |
| 4-6% | 40-69 | 一般 | 黄色 #FBC02D |
| 0-4% | 20-39 | 较差 | 橙色 #F57C00 |
| < 0% | 0-19 | 严重 | 红色 #D32F2F |

### 2. 时间进度达成率 (premium_time_progress_achievement_rate)

**业务含义**: 保费目标完成进度与时间进度的匹配度

**评分规则**:
| 原始值范围 | 评分范围 | 等级 | 色彩 |
|-----------|---------|------|------|
| ≥ 110% | 95-100 | 卓越 | 深绿 #2E7D32 |
| 100-110% | 86-94 | 健康 | 浅绿 #4CAF50 |
| 90-100% | 70-85 | 预警 | 黄色 #FBC02D |
| 80-90% | 40-69 | 危险 | 橙色 #F57C00 |
| < 80% | 0-39 | 高危 | 红色 #D32F2F |

### 3. 满期赔付率 (loss_ratio)

**业务含义**: 赔款支出占保费收入的比例（越小越好）

**评分规则**:
| 原始值范围 | 评分范围 | 等级 | 色彩 |
|-----------|---------|------|------|
| < 50% | 95-100 | 优秀 | 深绿 #2E7D32 |
| 50-60% | 86-94 | 良好 | 浅绿 #4CAF50 |
| 60-70% | 70-85 | 中等 | 蓝色 #1976D2 |
| 70-80% | 40-69 | 预警 | 黄色 #FBC02D |
| > 80% | 0-39 | 高危 | 红色 #D32F2F |

### 4. 满期出险率 (matured_claim_ratio)

**业务含义**: 出险保单占总保单的比例（越小越好）

**评分规则**:
| 原始值范围 | 评分范围 | 等级 | 色彩 |
|-----------|---------|------|------|
| < 15% | 95-100 | 优秀 | 深绿 #2E7D32 |
| 15-25% | 86-94 | 良好 | 浅绿 #4CAF50 |
| 25-35% | 70-85 | 中等 | 蓝色 #1976D2 |
| 35-50% | 40-69 | 预警 | 黄色 #FBC02D |
| > 50% | 0-39 | 高危 | 红色 #D32F2F |

### 5. 费用率 (expense_ratio)

**业务含义**: 费用支出占保费收入的比例（越小越好）

**评分规则**:
| 原始值范围 | 评分范围 | 等级 | 色彩 |
|-----------|---------|------|------|
| 0-7.5% | 95-100 | 优秀 | 深绿 #2E7D32 |
| 7.6-12.5% | 86-94 | 良好 | 浅绿 #4CAF50 |
| 12.6-17.5% | 70-85 | 中等 | 蓝色 #1976D2 |
| 17.6-22.5% | 40-69 | 一般 | 黄色 #FBC02D |
| > 22.5% | 0-39 | 较差 | 红色 #D32F2F |

---

## 💻 技术实现

### 核心文件

1. **评分转换工具**: `src/utils/radar-score.ts`
   - 定义5个维度的评分转换函数
   - 实现原始值到标准化评分的映射
   - 提供批量转换接口

2. **雷达图组件**: `src/components/features/multi-dimension-radar.tsx`
   - 使用 Recharts 库绘制雷达图
   - 实现悬停交互和高亮效果
   - 展示维度详细卡片

3. **页面集成**: `src/app/page.tsx`
   - 在多维图表页面（multichart tab）集成雷达图
   - 位于结构分布图上方
   - 传递当前和对比周的 KPI 数据

### 组件接口

```typescript
interface MultiDimensionRadarProps {
  /** 当前周期的 KPI 数据 */
  currentKpi: KPIResult | null
  /** 对比周期的 KPI 数据（上周） */
  compareKpi?: KPIResult | null
  /** 对比周次号 */
  compareWeekNumber?: number | null
  /** 自定义类名 */
  className?: string
}
```

### 数据流

```
useKPI() / useSmartComparison()
  ↓
KPIResult (原始百分比数据)
  ↓
convertKPIToRadarScores() (评分转换)
  ↓
RadarScoreResult[] (标准化评分 0-100)
  ↓
Recharts RadarChart (可视化呈现)
```

---

## 🎨 视觉设计

### 色彩方案

采用专业的五级预警色彩体系：

- **卓越/优秀**: 深绿色 #2E7D32
- **健康/良好**: 浅绿色 #4CAF50
- **中等**: 蓝色 #1976D2
- **预警/一般**: 黄色 #FBC02D / 橙色 #F57C00
- **危险/高危**: 红色 #D32F2F

### 布局结构

```
┌─────────────────────────────────────────┐
│ 标题栏 + 综合评分                         │
├─────────────────────────────────────────┤
│                                         │
│          雷达图可视化区域                 │
│      (当前周 + 上周对比折线)               │
│                                         │
├─────────────────────────────────────────┤
│ 五个维度的详细卡片（横向排列）              │
│ [边贡率] [进度] [赔付率] [出险率] [费用率] │
└─────────────────────────────────────────┘
```

### 交互效果

1. **悬停高亮**: 鼠标悬停在维度上，该维度卡片高亮显示
2. **详细 Tooltip**: 显示原始值、评分、等级、对比数据
3. **卡片交互**: 点击卡片可以与雷达图联动
4. **平滑动画**: 数据切换时有过渡动画

---

## 📈 使用指南

### 如何解读雷达图

1. **整体形态**: 雷达图越饱满（接近外圈），整体健康度越高
2. **对称性**: 形态越对称，各维度发展越均衡
3. **凹陷点**: 明显凹陷的维度是当前业务短板
4. **突出点**: 明显突出的维度是当前业务优势

### 综合评分计算

综合评分 = 5个维度评分的平均值（四舍五入）

### 对比分析

- **蓝色实线**: 当前周数据（深蓝色 `#1565C0`）
- **橙色虚线**: 上周数据（橙色 `#FF6B35`）
- **评分变化**: 绿色箭头↑表示改善，红色箭头↓表示恶化
- **颜色优化**: 2025-11-02 更新，确保无论差异多细微都能清晰识别

---

## 🔄 数据更新机制

雷达图数据随以下筛选条件实时变化：

- ✅ 时间范围筛选
- ✅ 机构筛选
- ✅ 业务类型筛选
- ✅ 客户分类筛选
- ✅ 其他所有维度筛选

当筛选条件变更时，雷达图会：
1. 重新计算5个维度的原始KPI值
2. 转换为标准化评分
3. 更新雷达图可视化
4. 更新维度详细卡片

---

## 📝 开发记录

### 2025-10-26 初始实现

**需求来源**: 用户需求 - 在多维图表页面增加雷达图

**实现内容**:
1. ✅ 创建评分转换工具 `radar-score.ts`
2. ✅ 实现5个维度的评分规则
3. ✅ 开发雷达图组件 `multi-dimension-radar.tsx`
4. ✅ 集成到多维图表页面
5. ✅ 实现悬停高亮和详细卡片
6. ✅ 支持当前周与上周对比

**技术亮点**:
- 线性插值算法实现评分平滑过渡
- Recharts 雷达图高度定制化
- 响应式设计，适配不同屏幕尺寸
- 专业的色彩方案和视觉效果

### 2025-11-02 颜色对比优化

**需求来源**: 用户反馈 - 本周和上周颜色对比不够明显

**优化内容**:
1. ✅ 本周颜色从 `#1976D2` 调整为 `#1565C0`（更深蓝色）
2. ✅ 上周颜色从 `#94a3b8` 调整为 `#FF6B35`（橙色）
3. ✅ 增加线条粗细和填充透明度
4. ✅ 优化虚线样式，增强视觉区分

**优化效果**:
- 本周：深蓝色，更饱满的线条和圆点
- 上周：橙色，虚线样式，与本周形成强烈对比
- 无论差异多细微，都能清晰识别两个时期的数据

---

## 🚀 未来优化方向

### 短期优化 (P2)

- [x] 优化本周和上周颜色对比度（2025-11-02 已完成）
- [ ] 支持导出雷达图为图片
- [ ] 增加历史趋势对比（多周对比）
- [ ] 自定义维度权重

### 中期优化 (P3)

- [ ] 支持自定义维度选择
- [ ] 增加维度间相关性分析
- [ ] 智能推荐改进建议

---

## 📚 相关文档

- [核心计算逻辑](../../03_technical_design/core_calculations.md)
- [数据架构](../../03_technical_design/data_architecture.md)
- [色彩预警系统](../../03_technical_design/color_system.md) (如果有)
- [多维图表功能](../F005_structure_analysis/README.md)

---

## 🐛 已知问题

无

---

## 💡 FAQ

### Q1: 为什么我的雷达图显示"暂无数据"？

**A**: 请确保：
1. 已上传数据文件
2. 当前筛选条件下有数据记录
3. KPI 数据计算成功

### Q2: 评分规则可以自定义吗？

**A**: 当前版本评分规则固定在 `src/utils/radar-score.ts` 中，未来版本将支持自定义。

### Q3: 为什么某些维度评分为0？

**A**: 可能原因：
- 该维度的原始数据为 null 或 undefined
- 原始数据超出了评分规则定义的范围（会显示为最低分）

### Q4: 对比功能的数据来源是什么？

**A**: 对比数据来自 `useSmartComparison` hook，自动获取上一周的 KPI 数据进行对比。

---

**文档维护者**: Claude Code
**审核状态**: ✅ 已审核
